(function () { function e(e, t, n) { if (!e.addEventListener) { e.attachEvent(t, n) } else { e.addEventListener(t, n, true) } } function t(e, t) { if (typeof e === "undefined") { return false } var n = "innerText" in e ? "innerText" : "textContent"; try { e[n] = t } catch (r) { e.setAttribute("innerText", t) } } videojs.Youtube = videojs.MediaTechController.extend({ init: function (e, n, r) { this.features["progressEvents"] = false; this.features["timeupdateEvents"] = false; videojs.MediaTechController.call(this, e, n, r); this.isIos = /(iPad|iPhone|iPod)/g.test(navigator.userAgent); this.isAndroid = /(Android)/g.test(navigator.userAgent); this.playVideoIsAllowed = !(this.isIos || this.isAndroid); if (typeof n["source"] !== "undefined") { for (var i in n["source"]) { if (n["source"].hasOwnProperty(i)) { e.options()[i] = n["source"][i] } } } this.userQuality = videojs.Youtube.convertQualityName(e.options()["quality"]); this.player_ = e; this.playerEl_ = document.getElementById(e.id()); this.playerEl_.className += " vjs-youtube"; this.qualityButton = document.createElement("div"); this.qualityButton.setAttribute("class", "vjs-quality-button vjs-menu-button vjs-control"); this.qualityButton.setAttribute("tabindex", 0); var s = document.createElement("div"); this.qualityButton.appendChild(s); this.qualityTitle = document.createElement("span"); s.appendChild(this.qualityTitle); if (e.options()["quality"] !== "undefined") { t(this.qualityTitle, e.options()["quality"] || "auto") } var o = document.createElement("div"); o.setAttribute("class", "vjs-menu"); this.qualityButton.appendChild(o); this.qualityMenuContent = document.createElement("ul"); this.qualityMenuContent.setAttribute("class", "vjs-menu-content"); o.appendChild(this.qualityMenuContent); this.id_ = this.player_.id() + "_youtube_api"; this.el_ = videojs.Component.prototype.createEl("iframe", { id: this.id_, className: "vjs-tech", scrolling: "no", marginWidth: 0, marginHeight: 0, frameBorder: 0 }); this.el_.setAttribute("allowFullScreen", ""); this.playerEl_.insertBefore(this.el_, this.playerEl_.firstChild); if (/MSIE (\d+\.\d+);/.test(navigator.userAgent)) { var u = Number(RegExp.$1); this.addIframeBlocker(u) } else if (!/(iPad|iPhone|iPod|android)/g.test(navigator.userAgent)) { this.el_.className += " onDesktop"; this.addIframeBlocker() } this.parseSrc(e.options()["src"]); this.playOnReady = this.player_.options()["autoplay"] || false; this.forceSSL = !!(typeof this.player_.options()["forceSSL"] === "undefined" || this.player_.options()["forceSSL"] === true); this.forceHTML5 = !!(typeof this.player_.options()["forceHTML5"] === "undefined" || this.player_.options()["forceHTML5"] === true); this.updateIframeSrc(); var a = this; e.ready(function () { var t = a.playerEl_.querySelectorAll(".vjs-control-bar")[0]; t.appendChild(a.qualityButton); if (a.playOnReady && !a.player_.options()["ytcontrols"]) { if (typeof a.player_.loadingSpinner !== "undefined") { a.player_.loadingSpinner.show() } if (typeof a.player_.bigPlayButton !== "undefined") { a.player_.bigPlayButton.hide() } } e.trigger("loadstart") }); this.on("dispose", function () { if (this.ytplayer) { this.ytplayer.destroy() } if (!this.player_.options()["ytcontrols"]) { this.player_.off("waiting", this.bindedWaiting) } this.playerEl_.querySelectorAll(".vjs-poster")[0].style.backgroundImage = "none"; if (this.el_.parentNode) { this.el_.parentNode.removeChild(this.el_) } if (this.qualityButton.parentNode) { this.qualityButton.parentNode.removeChild(this.qualityButton) } if (typeof this.player_.loadingSpinner !== "undefined") { this.player_.loadingSpinner.hide() } if (typeof this.player_.bigPlayButton !== "undefined") { this.player_.bigPlayButton.hide() } if (this.iframeblocker) { this.playerEl_.removeChild(this.iframeblocker) } }) } }); videojs.Youtube.prototype.updateIframeSrc = function () { var e = { enablejsapi: 1, iv_load_policy: 3, playerapiid: this.id(), disablekb: 1, wmode: "transparent", controls: this.player_.options()["ytcontrols"] ? 1 : 0, html5: this.player_.options()["forceHTML5"] ? 1 : null, playsinline: this.player_.options()["playsInline"] ? 1 : 0, showinfo: 0, modestbranding: 1, rel: 0, autoplay: this.playOnReady ? 1 : 0, loop: this.player_.options()["loop"] ? 1 : 0, list: this.playlistId, vq: this.userQuality, origin: window.location.protocol + "//" + window.location.host }; if (window.location.protocol === "file:") { delete e.origin } for (var t in e) { if (e.hasOwnProperty(t) && (typeof e[t] === "undefined" || e[t] === null)) { delete e[t] } } var n = this; if (this.videoId === null) { this.el_.src = "about:blank"; setTimeout(function () { n.triggerReady() }, 500) } else { this.el_.src = (this.forceSSL || window.location.protocol === "file:" ? "https:" : window.location.protocol) + "//www.youtube.com/embed/" + this.videoId + "?" + videojs.Youtube.makeQueryString(e); if (this.player_.options()["ytcontrols"]) { this.player_.controls(false) } else if (typeof this.player_.poster() === "undefined") { setTimeout(function () { var e = n.playerEl_.querySelectorAll(".vjs-poster")[0]; e.style.backgroundImage = "url(https://img.youtube.com/vi/" + n.videoId + "/0.jpg)"; e.style.display = "" }, 100) } this.bindedWaiting = function () { n.onWaiting() }; this.player_.on("waiting", this.bindedWaiting); if (videojs.Youtube.apiReady) { this.loadYoutube() } else { videojs.Youtube.loadingQueue.push(this); if (!videojs.Youtube.apiLoading) { var r = document.createElement("script"); r.onerror = function (e) { n.onError(e) }; r.src = !this.forceSSL && window.location.protocol !== "file:" ? "//www.youtube.com/iframe_api" : "https://www.youtube.com/iframe_api"; var i = document.getElementsByTagName("script")[0]; i.parentNode.insertBefore(r, i); videojs.Youtube.apiLoading = true } } } }; videojs.Youtube.prototype.onWaiting = function () { this.player_.bigPlayButton.hide() }; videojs.Youtube.prototype.addIframeBlocker = function (t) { this.iframeblocker = videojs.Component.prototype.createEl("div"); this.iframeblocker.className = "iframeblocker"; this.iframeblocker.style.position = "absolute"; this.iframeblocker.style.left = 0; this.iframeblocker.style.right = 0; this.iframeblocker.style.top = 0; this.iframeblocker.style.bottom = 0; this.iframeblocker.style.zIndex = 9999; if (t && t < 9) { this.iframeblocker.style.opacity = .01 } else { this.iframeblocker.style.background = "rgba(255, 255, 255, 0.01)" } var n = this; e(this.iframeblocker, "mousemove", function (e) { if (!n.player_.userActive()) { n.player_.userActive(true) } e.stopPropagation(); e.preventDefault() }); e(this.iframeblocker, "click", function () { if (n.paused()) { n.play() } else { n.pause() } }); this.playerEl_.insertBefore(this.iframeblocker, this.el_.nextSibling) }; videojs.Youtube.prototype.parseSrc = function (e) { this.srcVal = e; if (e) { var n = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/; var r = e.match(n); if (r && r[2].length === 11) { this.videoId = r[2] } else { this.videoId = null } var i = /[?&]list=([^#\&\?]+)/; r = e.match(i); if (r !== null && r.length > 1) { this.playlistId = r[1] } else { if (this.playlistId) { delete this.playlistId } } var s = /[?&]vq=([^#\&\?]+)/; r = e.match(s); if (r !== null && r.length > 1) { this.userQuality = r[1]; t(this.qualityTitle, videojs.Youtube.parseQualityName(this.userQuality)) } } }; videojs.Youtube.prototype.src = function (e) { if (typeof e !== "undefined") { this.parseSrc(e); if (this.el_.src === "about:blank") { this.updateIframeSrc(); return } delete this.defaultQuality; if (this.videoId !== null) { if (this.player_.options()["autoplay"] && this.playVideoIsAllowed) { this.ytplayer.loadVideoById({ videoId: this.videoId, suggestedQuality: this.userQuality }) } else { this.ytplayer.cueVideoById({ videoId: this.videoId, suggestedQuality: this.userQuality }) } this.playerEl_.querySelectorAll(".vjs-poster")[0].style.backgroundImage = "url(https://img.youtube.com/vi/" + this.videoId + "/0.jpg)"; this.player_.poster("https://img.youtube.com/vi/" + this.videoId + "/0.jpg") } } return this.srcVal }; videojs.Youtube.prototype.load = function () { }; videojs.Youtube.prototype.play = function () { if (this.videoId !== null) { if (!this.player_.options()["ytcontrols"]) { this.player_.trigger("waiting") } if (this.isReady_) { this.ytplayer.setVolume(this.player_.volume() * 100); if (this.volumeVal > 0) { this.ytplayer.unMute() } else { this.ytplayer.mute() } if (this.playVideoIsAllowed) { this.ytplayer.playVideo() } } else { this.playOnReady = true } } }; videojs.Youtube.prototype.pause = function () { this.ytplayer.pauseVideo() }; videojs.Youtube.prototype.paused = function () { return this.ytplayer ? this.lastState !== YT.PlayerState.PLAYING && this.lastState !== YT.PlayerState.BUFFERING : true }; videojs.Youtube.prototype.currentTime = function () { return this.ytplayer && this.ytplayer.getCurrentTime ? this.ytplayer.getCurrentTime() : 0 }; videojs.Youtube.prototype.setCurrentTime = function (e) { this.ytplayer.seekTo(e, true); this.player_.trigger("timeupdate") }; videojs.Youtube.prototype.duration = function () { return this.ytplayer && this.ytplayer.getDuration ? this.ytplayer.getDuration() : 0 }; videojs.Youtube.prototype.currentSrc = function () { return this.srcVal }; videojs.Youtube.prototype.volume = function () { if (this.ytplayer && isNaN(this.volumeVal)) { this.volumeVal = this.ytplayer.getVolume() / 100; this.player_.volume(this.volumeVal) } return this.volumeVal }; videojs.Youtube.prototype.setVolume = function (e) { if (typeof e !== "undefined" && e !== this.volumeVal) { this.ytplayer.setVolume(e * 100); this.volumeVal = e; this.player_.trigger("volumechange") } }; videojs.Youtube.prototype.muted = function () { return this.mutedVal }; videojs.Youtube.prototype.setMuted = function (e) { if (e) { this.ytplayer.mute(); this.player_.volume(0) } else { this.ytplayer.unMute(); this.player_.volume(this.volumeVal) } this.mutedVal = e; this.player_.trigger("volumechange") }; videojs.Youtube.prototype.buffered = function () { if (this.ytplayer && this.ytplayer.getVideoBytesLoaded) { var e = this.ytplayer.getVideoBytesLoaded(); var t = this.ytplayer.getVideoBytesTotal(); if (!e || !t) { return 0 } var n = this.ytplayer.getDuration(); var r = e / t * n; var i = this.ytplayer.getVideoStartBytes() / t * n; return videojs.createTimeRange(i, i + r) } else { return videojs.createTimeRange(0, 0) } }; videojs.Youtube.prototype.supportsFullScreen = function () { return true }; videojs.Youtube.isSupported = function () { return true }; videojs.Youtube.canPlaySource = function (e) { return e.type === "video/youtube" }; videojs.Youtube.canControlVolume = function () { return true }; videojs.Youtube.loadingQueue = []; videojs.Youtube.prototype.loadYoutube = function () { this.ytplayer = new YT.Player(this.id_, { events: { onReady: function (e) { e.target.vjsTech.onReady() }, onStateChange: function (e) { e.target.vjsTech.onStateChange(e.data) }, onPlaybackQualityChange: function (e) { e.target.vjsTech.onPlaybackQualityChange(e.data) }, onError: function (e) { e.target.vjsTech.onError(e.data) } } }); this.ytplayer.vjsTech = this }; videojs.Youtube.makeQueryString = function (e) { var t = []; for (var n in e) { if (e.hasOwnProperty(n)) { t.push(n + "=" + e[n]) } } return t.join("&") }; window.onYouTubeIframeAPIReady = function () { var e; while (e = videojs.Youtube.loadingQueue.shift()) { e.loadYoutube() } videojs.Youtube.loadingQueue = []; videojs.Youtube.apiReady = true }; videojs.Youtube.prototype.onReady = function () { this.isReady_ = true; this.triggerReady(); this.player_.trigger("loadedmetadata"); this.player_.trigger("durationchange"); this.player_.trigger("timeupdate"); if (typeof this.player_.loadingSpinner !== "undefined") { this.player_.loadingSpinner.hide() } if (this.player_.options()["muted"]) { this.setMuted(true) } if (this.playOnReady) { this.playOnReady = false; this.play() } }; videojs.Youtube.prototype.updateQualities = function () { function n(n) { e(n, "click", function () { var e = this.getAttribute("data-val"); i.ytplayer.setPlaybackQuality(e); i.userQuality = e; t(i.qualityTitle, videojs.Youtube.parseQualityName(e)); var n = i.qualityMenuContent.querySelector(".vjs-selected"); if (n) { videojs.Youtube.removeClass(n, "vjs-selected") } videojs.Youtube.addClass(this, "vjs-selected") }) } var r = this.ytplayer.getAvailableQualityLevels(); var i = this; if (r.indexOf(this.userQuality) < 0) { t(i.qualityTitle, videojs.Youtube.parseQualityName(this.defaultQuality)) } if (r.length === 0) { this.qualityButton.style.display = "none" } else { this.qualityButton.style.display = ""; while (this.qualityMenuContent.hasChildNodes()) { this.qualityMenuContent.removeChild(this.qualityMenuContent.lastChild) } for (var s = 0; s < r.length; ++s) { var o = document.createElement("li"); o.setAttribute("class", "vjs-menu-item"); t(o, videojs.Youtube.parseQualityName(r[s])); o.setAttribute("data-val", r[s]); if (r[s] === this.quality) { videojs.Youtube.addClass(o, "vjs-selected") } n(o); this.qualityMenuContent.appendChild(o) } } }; videojs.Youtube.prototype.onStateChange = function (e) { if (e !== this.lastState) { switch (e) { case -1: this.player_.trigger("durationchange"); break; case YT.PlayerState.ENDED: if (!this.player_.options()["ytcontrols"]) { this.playerEl_.querySelectorAll(".vjs-poster")[0].style.display = "block"; if (typeof this.player_.bigPlayButton !== "undefined") { this.player_.bigPlayButton.show() } } this.player_.trigger("ended"); break; case YT.PlayerState.PLAYING: this.playVideoIsAllowed = true; this.updateQualities(); this.player_.trigger("timeupdate"); this.player_.trigger("durationchange"); this.player_.trigger("playing"); this.player_.trigger("play"); break; case YT.PlayerState.PAUSED: this.player_.trigger("pause"); break; case YT.PlayerState.BUFFERING: this.player_.trigger("timeupdate"); if (!this.player_.options()["ytcontrols"]) { this.player_.trigger("waiting") } break; case YT.PlayerState.CUED: break } this.lastState = e } }; videojs.Youtube.convertQualityName = function (e) { switch (e) { case "144p": return "tiny"; case "240p": return "small"; case "360p": return "medium"; case "480p": return "large"; case "720p": return "hd720"; case "1080p": return "hd1080" } return "auto" }; videojs.Youtube.parseQualityName = function (e) { switch (e) { case "tiny": return "144p"; case "small": return "240p"; case "medium": return "360p"; case "large": return "480p"; case "hd720": return "720p"; case "hd1080": return "1080p" } return "auto" }; videojs.Youtube.prototype.onPlaybackQualityChange = function (e) { if (typeof this.defaultQuality === "undefined") { this.defaultQuality = e; if (typeof this.userQuality !== "undefined") { return } } this.quality = e; t(this.qualityTitle, videojs.Youtube.parseQualityName(e)); switch (e) { case "medium": this.player_.videoWidth = 480; this.player_.videoHeight = 360; break; case "large": this.player_.videoWidth = 640; this.player_.videoHeight = 480; break; case "hd720": this.player_.videoWidth = 960; this.player_.videoHeight = 720; break; case "hd1080": this.player_.videoWidth = 1440; this.player_.videoHeight = 1080; break; case "highres": this.player_.videoWidth = 1920; this.player_.videoHeight = 1080; break; case "small": this.player_.videoWidth = 320; this.player_.videoHeight = 240; break; case "tiny": this.player_.videoWidth = 144; this.player_.videoHeight = 108; break; default: this.player_.videoWidth = 0; this.player_.videoHeight = 0; break } this.player_.trigger("ratechange") }; videojs.Youtube.prototype.onError = function (e) { this.player_.error(e); if (e === 100 || e === 101 || e === 150) { this.player_.bigPlayButton.hide(); this.player_.loadingSpinner.hide(); this.player_.posterImage.hide() } }; videojs.Youtube.addClass = function (e, t) { if ((" " + e.className + " ").indexOf(" " + t + " ") === -1) { e.className = e.className === "" ? t : e.className + " " + t } }; videojs.Youtube.removeClass = function (e, t) { var n, r; if (e.className.indexOf(t) === -1) { return } n = e.className.split(" "); for (r = n.length - 1; r >= 0; r--) { if (n[r] === t) { n.splice(r, 1) } } e.className = n.join(" ") }; var n = document.createElement("style"); var r = " " + ".vjs-youtube .vjs-poster { background-size: 100%!important; }" + ".vjs-youtube .vjs-poster, " + ".vjs-youtube .vjs-loading-spinner, " + ".vjs-youtube .vjs-text-track-display{" + "    pointer-events: none !important;" + " }" + ".vjs-youtube.vjs-user-active .iframeblocker { display: none; }" + ".vjs-youtube.vjs-user-inactive .vjs-tech.onDesktop { pointer-events: none; }" + ".vjs-quality-button > div:first-child > span:first-child { position:relative;top:7px }"; n.setAttribute("type", "text/css"); document.getElementsByTagName("head")[0].appendChild(n); if (n.styleSheet) { n.styleSheet.cssText = r } else { n.appendChild(document.createTextNode(r)) } if (!Array.prototype.indexOf) { Array.prototype.indexOf = function (e) { var t = this.length >>> 0; var n = Number(arguments[1]) || 0; n = n < 0 ? Math.ceil(n) : Math.floor(n); if (n < 0) { n += t } for (; n < t; n++) { if (n in this && this[n] === e) { return n } } return -1 } } })()